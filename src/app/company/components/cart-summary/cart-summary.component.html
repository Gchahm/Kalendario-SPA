<app-kalendario-card>
  <div class="row m-4">

    <div class="col-12">
      <company-logo-shell></company-logo-shell>
    </div>

    <div class="col-12 m-4">
      {{preBookMessage}}
    </div>


    <ng-container *ngFor="let apt of appointments()">
      <div class="col-9">{{apt.service.name}}</div>
      <div class="col-3 text-right c-primary">{{apt.service.price}}</div>
    </ng-container>

    <div class="col-12 m-2"></div>

    <div class="col-9 h6">
      Kalendario Fee
    </div>
    <div class="col-3 text-right c-primary">{{request.fee | currency :'€'}}</div>

    <div class="col-12 m-2"></div>

    <div class="col-9 h5">
      TOTAL
    </div>
    <div class="col-3 h5 text-right c-primary">{{request.total | currency :'€'}}</div>

    <div *ngIf="!checkoutMode; else checkoutContainer" class="col-12">

      <mat-form-field>
        <textarea matInput
                  [(ngModel)]="customerNotes"
                  placeholder="additional information"></textarea>
      </mat-form-field>

      <button (click)="proceedCheckout()" class="btn btn-block btn-primary">Proceed to Checkout</button>
    </div>

    <ng-template #checkoutContainer>

      <div class="col-12">
        <div class="additional-info-box">
          <div class="additional-info-box-title text-small">Notes</div>
          <p>{{customerNotes}}</p>
        </div>
      </div>

      <div *ngIf="paymentDetails" class="col-12">
        <stripe-card-element [total]="request.total | currency :'€'"
                             [clientSecret]="paymentDetails.clientSecret"
                             (confirmPay)="confirmRequest()"></stripe-card-element>
      </div>

      <div *ngIf="!paymentDetails" class="col-12">
        <button *ngIf="company.config.canReceiveCardPayments"
                (click)="requestPaymentDetails.emit(request.id)"
                class="btn btn-primary mr-2">
          Pay with Card
        </button>
        <button *ngIf="company.config.canReceiveUnpaidRequest"
                (click)="confirmRequest()" class="btn btn-accent">
          Pay Cash Onsite
        </button>
      </div>
    </ng-template>

  </div>
</app-kalendario-card>



